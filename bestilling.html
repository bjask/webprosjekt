<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <link rel="StyleSheet" type="text/css" href="stilark.css" /><!--CSS-stilark-->
    <title>Bestill hytte</title>
    <script src="http://www.w3schools.com/lib/w3data.js"></script> <!-- script for å inkludere filer med html-tagger -->
    <script src="hyttevalgjavascript.js"></script>                 <!-- script for å inkludere javascriptfil -->
    <script src="jquery-3.1.1.js"></script>                       <!-- script for å inkludere jQuerybiblioteket -->

  </head>
  <body>
    <div w3-include-html="tittel.html" id="heading"></div>
    <div w3-include-html="meny.html" id="meny"></div>
    <script>w3IncludeHTML();</script>
       <!--Avsnittet inkluderer filer med html-innhold for tittel og meny -->

       <script type="text/javascript" language="javascript">
       function Sum() {                                       //Regner ut prisen
         var tekst='hytte[hytteid="';
         var timepris ="";
         var dognpris ="";
         var sum=0;
         var tid = window.document.getElementById("bestilling").tid.value;
         var bruksomrade = window.document.getElementById("bestilling").bruksomrade.value;
         var hytte = window.document.getElementById("bestilling").hytteNavn.value;
         var vask = window.document.getElementById("bestilling").onskerVask.checked;
         var medlem = window.document.getElementById("bestilling").erMedlem.checked;

         switch (hytte) {
           case "Havblikk":
            hyttenr="1";
           break;
           case "Moserabben":
            hyttenr="2";
            break;
           case "Tussebo":
            hyttenr="3";
           break;
           default:
            hyttenr="x";
         }
         if (hyttenr=="x"||bruksomrade=="Bruk") {
           alert("Du må velge både hytte og type bruk før du kan regne ut en pris.");
         }
           else {

         if (bruksomrade=="Dagstur" & Number(tid)>8) {
           alert("Du kan ikke leie hytta mer enn 8 timer på en dag. Velg heller leie én dag.");
         }
         else {
         if (hyttenr != "x") {

         timepris = tekst + hyttenr + '"] timepris';
         dognpris = tekst + hyttenr + '"] dognpris';

           $.ajax({          //Her hentes info om hyttene fra hytter.xml-fila.
           type: "GET",
           url: "hytter.xml",
           dataType: "xml",
           success: function(xml) {

             timepris = $(xml).find(timepris).text();
             dognpris = $(xml).find(dognpris).text();
           }
          });
    setTimeout(function(){                      //Legger inn tidsforsinkelse for at ajaxkommandoene skal rekke å bli fullført.
      if (bruksomrade == "Dagstur") {
            sum = Number(timepris) * Number(tid);
            }
      if (bruksomrade == "Overnatting") {
            sum = Number(dognpris) * Number(tid);
            }
      if (vask) {
        sum = sum + 300;
      }
      if (medlem) {
        sum = Math.round(sum * 0.85);
      }

      window.document.getElementById("sumHer").value = "Kr " + sum + ",-";     //Skriver prisen til det skjulte tekstfeltet.
    }, 300);
        }
      }
    }
  }



         function sjekkSkjema() {  //Sjekker om alt er korrekt utfylt
           var hytte = window.document.getElementById("bestilling").hytteNavn.value;
           var kjøperMobil = window.document.getElementById("bestilling").mobil.value;
           var kjøperBetalingstype = window.document.getElementById("bestilling").betalingstype.value;

           if (hytte == "Navn") {
            alert("Du må velge en hytte!");
            return false;
           }
           if (kjøperMobil.toString().length < 8) {
             alert("Dette er ikke et gyldig mobilnummer");
             return false;
           }
           if (kjøperMobil.toString().length > 8) {
             alert("Dette er ikke et gyldig mobilnummer");
             return false;
           }
           if (kjøperBetalingstype == "Betalingstype") {
             alert("Du må velge hvordan du vil betale");
             return false;
           }
           if (kjøperBetalingstype == "Faktura") {
             alert("Faktura sendes i posten");
             window.document.getElementById("sumHer").disabled = false; //Må aktivere det inaktive prisfeltet for at det skal bli med i sendingen.
             return true;
           }
           window.document.getElementById("sumHer").disabled = false;
           return true;
         }

         function betalingskort() {   //Skjuler eller viser betalingskortinfo
           var kortnr = window.document.getElementById("bestilling").kortnummer.value;
           var kortEier = window.document.getElementById("bestilling").korteier.value;
           var kortCVC = window.document.getElementById("bestilling").cvc.value;
           var kortUtlop = window.document.getElementById("bestilling").utløp.value;
           var kjøperBetalingstype = window.document.getElementById("bestilling").betalingstype.value;

           if (kjøperBetalingstype == "VISA") {
             window.document.getElementById("kortinfo").style.visibility = "visible";
             window.document.getElementById("kortnummer").required = true;
             window.document.getElementById("korteier").required = true;
             window.document.getElementById("cvc").required = true;
             window.document.getElementById("utløp").required = true;
           }
           if (kjøperBetalingstype == "MasterCard") {
             window.document.getElementById("kortinfo").style.visibility = "visible";
             window.document.getElementById("kortnummer").required = true;
             window.document.getElementById("korteier").required = true;
             window.document.getElementById("cvc").required = true;
             window.document.getElementById("utløp").required = true;
           }
           if (kjøperBetalingstype == "Faktura") {
             window.document.getElementById("kortinfo").style.visibility = "hidden";
             window.document.getElementById("kortnummer").required = false;
             window.document.getElementById("korteier").required = false;
             window.document.getElementById("cvc").required = false;
             window.document.getElementById("utløp").required = false;
           }
           if (kjøperBetalingstype == "Betalingstype") {
             window.document.getElementById("kortinfo").style.visibility = "hidden";
             window.document.getElementById("kortnummer").required = false;
             window.document.getElementById("korteier").required = false;
             window.document.getElementById("cvc").required = false;
             window.document.getElementById("utløp").required = false;
           }
         }
       </script>
<!--http://www.iie.hist.no/fag/webutvikling1/prosjekt/behandle.php-->
<div align="center">
  <form action="http://www.iie.hist.no/fag/webutvikling1/prosjekt/behandle.php" id="bestilling" method="post" onsubmit="return sjekkSkjema();">
    <fieldset>
      <legend>Hytte</legend>
      <table align="left">
        <tr>
          <td><label for="hytteNavn">Hyttenavn: </label></td>
          <td><select id="hytteNavn" required>
            <option>Navn</option>
            <option>Havblikk</option>
            <option>Moserabben</option>
            <option>Tussebo</option>
          </select>
        </tr>
        <tr>
          <td><label for="startDato">Start dato: </label></td>
          <td><input type="date" name="startDato" id="startDato" required></td>
          <td id="hoyre"><label for="startTime">Kl: </label></td>
          <td><input type="time" name="startTime" id="startTid" required></td>
        </tr>
        <tr>
          <td><label for="bruk">Type bruk: </label></td>
          <td><select id="bruk" name="bruksomrade" required>
            <option>Bruk</option>
            <option>Dagstur</option>
            <option>Overnatting</option>
          </select>
          <td><label for="tid">Døgn/timer: </label></td>
          <td><input type="number" name="tid" id="tid" value="0" required></td>
        </tr>
      </table>
      <table align="left">
        <tr>
          <td><label for="erMedlem">Er du medlem av skiforeningen?</label></td>
        </tr>
        <tr>
          <td>Ja<input type="radio" name="medlem" id="erMedlem" value="1"/>Nei<input type="radio" name="medlem" id="erIkkeMedlem" value="0" checked="true"/></td>
        </tr>
        <tr>
          <td><label for="vask">Ønsker du betalt vask? (300kr)</label></td>
        </tr>
        <tr>
          <td>Ja<input type="radio" name="vask" id="onskerVask" value="1" checked="true"/>Nei<input type="radio" name="vask" id="onskerIkkeVask" value="0"/></td>
        </tr>
        <tr align="center">
          <td><input type="button" value="Sjekk prisen" onclick="Sum()" ></td>
          <td>Prisen ble:<input name="Pris"  id="sumHer"  type="text" value="0,-" disabled /></td> <!-- Viser prisen i et inaktivt tekstfelt for at innholdet skal vises i bestillingseposten -->
        </tr>
      </table>
    </fieldset>
    <fieldset>
      <legend>Kunde informasjon</legend>
      <table align="left">
        <tr>
          <td><label for="fornavn">Fornavn: </label></td>
          <td><input type="text" name="fornavn" id="fornavn" required></td>
        </tr>
        <tr>
          <td><label for="etternavn">Etternavn: </label></td>
          <td><input type="text" name="etternavn" id="etternavn" required></td>
        </tr>
        <tr>
          <td><label for="gate">Adresse: </label></td>
          <td><input type="text" name="gate" id="gate" required></td>
          <td><label for="husnummer">Husnummer: </label></td>
          <td><input type="number" name="husnummer" id="husnummer" max="1000" min="1" required></td>
        </tr>
        <tr>
          <td><label for="poststed">Poststed: </label></td>
          <td><input type="text" name="poststed" id="poststed" required></td>
          <td><label for="postnr">Postnummer: </label></td>
          <td><input type="number" name="postnr" id="postnr" max="9999" min="1000" required></td>
        </tr>
        <tr>
          <td><label for="epost">E-post: </label></td>
          <td><input type="email" name="epost" id="epost" required></td>
        </tr>
        <tr>
          <td><label for="mobil">Mobilnummer: </label></td>
          <td><input type="tel" name="mobil" id="mobil" min="00000000" max="99999999" required></td>
        </tr>
        <tr>
          <td><label for="betalingstype">Betalingstype: </label></td>
          <td><select id="betalingstype" required onchange="betalingskort()">   <!-- Skjuler eller viser betalingskortinfo. -->
            <option>Betalingstype</option>
            <option>VISA</option>
            <option>MasterCard</option>
            <option>Faktura</option>
          </select>
        </tr>
      </table>
    </fieldset>
    <fieldset id="kortinfo">
      <legend>Betalingsinformasjon</legend>
      <table align="left">
        <tr>
          <td><label for="kortnummer">Kortnummer: </label></td>
          <td><input type="number" name="kortnummer" id="kortnummer"></td>
        </tr>
        <tr>
          <td><label for="korteier">Kortholders navn: </label></td>
          <td><input type="text" name="korteier" id="korteier"></td>
        </tr>
        <tr>
          <td><label for="cvc">CVC-kode: </label></td>
          <td><input type="number" name="cvc" id="cvc" max="999" min="0"></td>
        </tr>
        <tr>
          <td><label for="utløp">Utløpsdato: </label></td>
          <td><input type="month" name="utløp" id="utløp"></td>
      </table>
    </fieldset>
      <table id="bestillingKnapper">
        <tr>
          <td><input type="submit" value="Bestill"></td>
          <td><input type="reset" value="Tøm skjema"></td>
        </tr>
      </table>
    </form>
  </div>

  </body>
</html>
